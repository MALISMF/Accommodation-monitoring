# Архитектура парсера отелей Ostrovok

## Назначение

Парсер собирает список отелей Иркутской области с сайта ostrovok.ru, извлекая названия и адреса, и сохраняет результаты в JSON и CSV форматах.

## Зависимости

- `playwright` - автоматизация браузера
- `json` - сохранение данных в JSON
- `csv` - сохранение данных в CSV
- `urllib.parse` - работа с URL и query-параметрами

## Структура модулей

### Вспомогательные функции

**close_search_popup(page)**
- Закрывает попап поиска через кнопку с `aria-label*="close"`
- Логирует результат операции

**save_page_html(page, filename)**
- Сохраняет HTML текущей страницы в файл для отладки

**get_hotel_cards(page)**
- Извлекает данные отелей с текущей страницы
- Ищет элементы по `data-testid="hotel-card-name"` и `data-testid="hotel-card-distance-address"`
- Возвращает список словарей: `[{'name': str, 'address': str}, ...]`
- Сопоставляет названия и адреса по индексу элементов

**goto_page(page, page_number)**
- Переходит на указанную страницу через изменение query-параметра `page` в URL
- Сохраняет остальные параметры URL

### Основные функции

**paginate_and_extract_all_hotels(page, hotels)**
- Обходит страницы результатов через URL-пагинацию
- Проверяет наличие ссылки на следующую страницу в пагинации
- Использует ретраи (до 3 попыток) с прокруткой для загрузки карточек
- Собирает все отели без удаления дубликатов
- Ограничение: обрабатывает максимум 5 страниц (отладочный лимит)

**get_hotels_list()**
- Главная функция парсера
- Последовательность операций:
  1. Открывает браузер через Playwright
  2. Переходит на страницу результатов
  3. Закрывает попапы
  4. Сохраняет HTML первой страницы
  5. Извлекает отели с первой страницы
  6. Обходит все страницы через `paginate_and_extract_all_hotels`
  7. Сохраняет результаты в `hotels_list.json` и `hotels_list.csv`
  8. Выводит первые 10 отелей в консоль


## Поток выполнения

```
get_hotels_list()
  ├─> Запуск браузера
  ├─> Переход на страницу результатов
  ├─> close_search_popup()
  ├─> Ожидание загрузки карточек
  ├─> save_page_html()
  ├─> get_hotel_cards() [страница 1]
  ├─> paginate_and_extract_all_hotels()
  │     ├─> Определение текущей страницы из URL
  │     ├─> Проверка наличия ссылки на следующую страницу
  │     ├─> goto_page()
  │     ├─> Ретраи загрузки карточек (scroll + wait)
  │     └─> get_hotel_cards() [страницы 2-N]
  ├─> Сохранение в JSON
  ├─> Сохранение в CSV
  └─> Закрытие браузера
```

## Формат данных

**Входные данные:**
- URL страницы результатов: `https://ostrovok.ru/hotel/russia/western_siberia_irkutsk_oblast_multi/?type_group=hotel`

**Выходные данные:**
- JSON: массив объектов `[{"name": str, "address": str}, ...]`
- CSV: таблица с колонками `hotel_name` и `address`, разделитель `;`, кодировка `utf-8-sig`

## Селекторы элементов

- Название отеля: `a[data-testid="hotel-card-name"]`
- Адрес отеля: `[data-testid="hotel-card-distance-address"]`
- Кнопка закрытия попапа: `button[aria-label*="close" i]`
- Ссылка на страницу N: `a:has-text("{N}")`

## Особенности реализации

- Использует URL-пагинацию вместо кликов по кнопкам
- Ретраи с прокруткой для надежной загрузки динамического контента
- Обработка ошибок на уровне отдельных операций
- Настройка кодировки stdout для корректного вывода кириллицы
- Сохранение HTML для отладки и анализа разметки
